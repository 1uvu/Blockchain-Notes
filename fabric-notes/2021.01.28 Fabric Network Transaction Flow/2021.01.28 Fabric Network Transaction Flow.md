# Fabric Network: Transaction Flow

## Content

[TOC]

## 笔记

![flow-simple](res/2021.01.28%20Fabric%20Network%20Transaction%20Flow/flow-simple.png)

交易流程：client 通过 cli 或 sdk 发送，并根据交易提案选择目标背书节点，然后向其发送交易提案；
背书节点收到提案后，按照交易提案中的交易请求调用相应的链码，得出结果（读写集，读集和写集分别是什么），返回背书节点的签名（对读写集的签名）；
客户端验证返回的背书结果是否符合背书策略，是否一致等，符合则将交易（读写集）发送给排序节点，这些验证也可不做；
排序节点根据排序策略对交易排序，打包，分发给提交节点；
提交节点验证区块中的交易（读写集）（第二次验证），因为这个过程是异步的，所以会对这个读写集的一致性进行验证，解决了双花问题，成功则提交，失败则拒绝。

根据[官方文档](https://hyperledger-fabric.readthedocs.io/zh_CN/release-2.2/txflow.html)的流程，梳理简化叙述一遍，圈出重点:

- 交易提案结构
- SDK 打包后结构
- 背书节点如何验证交易提案之前没有被提交过（重放攻击保护）
- 签名有效性如何验证
- 提案发起者权限如何验证
- “也就是说，每个背书节点确保发起者满足通道 *Writers* 策略” 是什么意思
- 链码函数参数长什么样
- “根据当前状态数据库执行链码，生成交易结果，包括响应值、读集和写集（即表示要创建或更新的资产的键值对）” 中如何执行、交易结果长什么样、响应值都包括什么、读写集是什么，都有什么作用
- 提案响应的格式
- 如果恶意客户端一直散布未背书的交易怎么办，会不会影响网络性能
- 排序节点，排序时对于来自不同通道的交易如何处理；对于来自同一通道的多个交易如何处理，排序策略是如何生效的。“排序服务只是从网络中的所有通道接收交易，将它们按时间按通道排序，并将每个通道的交易打包成区块。”
- 区块如何传播到 peer，传播到哪些 peer（committer 如何验证），peer 对区块都进行哪些验证，验证无效的交易怎么办，也存到区块链吗，之后的区块怎么办
- 账本更新包括哪些流程，顺序如何，如何通知给其它节点和客户端等更新完毕了

根据流程对重点进行解说

- 如何理解 “智能合约和账本将网络中共享的*流程*和*信息*对应地封装起来。”

最后再把整个流程串一遍

