挖矿就是不断地尝试 nonce 值，使得计算得到的哈希值小于 target 哈希值。

target 越小，挖矿难度越大，也就是通过调整目标输出空间的大小，越小，难度越大。

也就是调整目标空间占整个输出空间的比例。

比特币的哈希算法是 SHA-256 -> 2^256

### 为什么调整挖矿难度

随着矿工越来越多，矿机越来越强大，出块时间会变小，这会带来分叉太多的问题：

因为比特币网络传播的特点，邻居泛洪以及尽最大努力尝试等，系统中会出现非常多的分叉。

这意味着什么呢？举个例子：

假设一个区块后面出现了 10 个分叉，其中 1 个恶意区块，9 个诚实区块。

那么新挖到的诚实区块就会平均分到 9 个分叉中，而此时这 1 个恶意的区块就能够通过集中算力，可以很容易地成为最长合法链。

因为，这相当于将系统中的诚实的算力分成了独立的 9 份，使得原本需要 51% 才可以控制最长合法链的算力需求，乘法级减小。

假设诚实区块连接到区块的概率相等，此时假如恶意节点掌握了大于 10% 的系统算力，就可以发动分叉攻击。

### 如何调整挖矿难度

每隔 2016 个区块调整一次 target，大概是 2 周。

按照公式：target = target x (actual time /expected time)

actual time：系统中最近的产生 2016 个区块的实际时间

expected time：2016 x 10min

目标阈值减小和增大都不会超过 4 倍。

特别注意：挖矿难度与目标阈值成反比。